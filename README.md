# ИДЗ-3

## Талалаев Геннадий Алексеевич БПИ219 Вариант 36

## Условие задачи:

Задача о сельской библиотеке. В библиотеке имеется N книг, Каждая из книг в одном экземпляре. M читателей регулярно за- глядывают в библиотеку, выбирает для чтения одну книгу и читает ее некоторое количество дней. Если желаемой книги нет, то чи- татель дожидается от библиотекаря информации об ее появлении и приходит в библиотеку, чтобы специально забрать ее. Возмож- на ситуация, когда несколько читателей конкурируют из-за этой популярной книги. Создать приложение, моделирующее за- данный процесс. Библиотекарь — сервер. Читатели клиенты.

### Сущности:

- Сервер библеотека: Управляет управляет библиотекой и выдает книги.
- Клиенты-посетители: взаимодействуют с библиотекой и книгами.
- Наблюдатель.

### Сценарий и взаимодействия:
0. Общий сценарий
    - Сервер создает TCP-сокет и начинает слушать заданный порт.
    - Клиенты устанавливают соединение с сервером.
    - При появлении нового клиента сервер принимает его соединение и создает новый поток для обработки клиента.
    - В каждом потоке клиента происходит обмен данными с сервером.
    - Клиент может отправлять запросы на получение книги или возврат книги.
    - Сервер обрабатывает запросы, обновляет состояние книг и отправляет ответы клиенту.
    - Процесс повторяется для каждого клиента, пока сервер не завершит свою работу.

1. Взаимодействие :
    - Функция DieWithError используется для обработки ошибок. Если происходит ошибка, функция выводит сообщение об ошибке и завершает программу.
    - Функция handleClient представляет поток, который обрабатывает взаимодействие с каждым клиентом.
    - Функция clientThread представляет поток, который принимает входящие соединения от клиентов.
    - Функция createTCPSocket создает TCP-сокет, связывает его с заданным портом и возвращает его дескриптор. 
    - В функции main происходит инициализация переменных и запуск сервера. 

### 4-5
- компилировать 
    gcc library.c -o library -lrt -lpthread
    gcc reader.c -o reader
- запускать
    ./library 8000 <кол-во книг>
    ./reader 127.0.0.1 8000 <кол-во книг>
    читателей может быть несколько

### 6-7
- компилировать
    gcc library.c -o library -lrt -lpthread
    gcc reader.c -o reader
    gcc observer.c -o observer
- запускать
    ./library 8000 8001 <кол-во книг>
    ./reader 127.0.0.1 8000 <кол-во книг>
    ./observer 127.0.0.1 8001
    читателей может быть несколько


### 8
На оценку 8 наблюдателей может быть несколько и их можно подключать-отключать через ctrl-c прямо когда все работает.

